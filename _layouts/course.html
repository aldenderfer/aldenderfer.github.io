---
layout: nil
---

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>{{ page.course_id }}:  {{ page.course_title }}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="/courses/course.css" />
</head>

<body>
  <main class="page">
    <header>
      {% if page.minors %}
        <div class="badge-row">
          {% for minor in page.minors %}
            <span class="badge badge-minor">{{ minor }}</span>
          {% endfor %}
        </div>
      {% endif %}

      <h1>{{ page.course_id }}: {{ page.course_title }}</h1>
      <p class="subtitle">{{ page.course_subtitle }}</p>

      <div class="about-section">

        <!-- Left column: course description -->
        <div class="about-description">
          <h2>About the Course</h2>
          <p>{{ page.course_description }}</p>
        </div>

        <!-- Right column: course details -->
        <div class="about-meta-card">
          <h2>Course Details</h2>
          <ul class="about-meta-list">
            {% if page.level %}
              <li><strong>Level:</strong> {{ page.level }}</li>
            {% endif %}
            {% if page.prereqs %}
              <li><strong>Prerequisites:</strong> {{ page.prereqs }}</li>
            {% endif %}
            {% if page.instructor %}
              <li><strong>Instructor:</strong> {{ page.instructor }}</li>
            {% endif %}
            {% if page.contact_info %}
              <li><strong>Contact Info:</strong> {{ page.contact_info }}</li>
            {% endif %}
            {% if page.semester %}
              <li><strong>Semester(s) Offered:</strong> {{ page.semester }}</li>
            {% endif %}
          </ul>
        </div>
      </div>
    </header>

    <section>
      <h2>Course Structure</h2>
      <p>
        {{ page.course_structure }}
      </p>
    </section>

    <section>
      <h2>Selected Student Projects</h2>
      <br>

      <div class="project-grid">
        
        {% assign course_projects = site.projects | where: "course_id", page.course_id %}
        {% if course_projects == nil or course_projects.size == 0 %}
          {% assign course_projects = site.pages | where: "course_id", page.course_id %}
        {% endif %}
        {% if course_projects %}
          {% assign course_projects = course_projects | sort: "order" %}
        {% endif %}

        {% for project in course_projects %}
          {% unless project.visible == false %}
          <article class="project-card">

            {%- comment -%}
            Build media list as: all video entries declared in front matter
            plus any image files present in the same project directory as
            this project's `index.md`. Images are not expected to be listed
            in front matter anymore.
            {%- endcomment -%}
            {% assign video_items = project.media | where: "type", "video" %}
            {% assign video_count = video_items | size | default: 0 %}
            {%- comment -%}
            Try to discover images by inspecting `site.static_files` and matching
            against the rendered `project.url`. This is more reliable than
            checking source `_projects` paths because `f.url` reflects Jekyll's
            published paths.
            {%- endcomment -%}
            {% assign media_count = video_count %}
            {%- comment -%}
            Derive the project's source directory from `project.path` and count
            image files in `site.static_files` that live in that directory.
            This keeps all discovery logic in Liquid and does not touch
            project markdown files.
            {%- endcomment -%}
            {% assign parts = project.path | split: '/' %}
            {% assign parts_count = parts | size %}
            {% if parts_count > 1 %}
              {% assign dir_count = parts_count | minus: 1 %}
              {% assign dir_parts = parts | slice: 0, dir_count %}
              {% assign src_dir = dir_parts | join: '/' %}
            {% else %}
              {% assign src_dir = project.path %}
            {% endif %}
            {% assign pub_dir = '/' | append: src_dir | append: '/' %}

            {% assign image_count = 0 %}
            {% for f in site.static_files %}
              {% assign ext = f.extname | downcase %}
              {% if ext == '.jpg' or ext == '.jpeg' or ext == '.png' or ext == '.gif' %}
                {% assign rel = f.relative_path | default: '' %}
                {% assign matched = false %}
                {% if rel != '' %}
                  {% if rel contains pub_dir %}
                    {% assign matched = true %}
                  {% endif %}
                {% endif %}
                {% if matched == false %}
                  {% if f.path contains src_dir %}
                    {% assign matched = true %}
                  {% endif %}
                {% endif %}
                {% if matched == true %}
                  {% assign image_count = image_count | plus: 1 %}
                {% endif %}
              {% endif %}
            {% endfor %}
            {% assign media_count = media_count | plus: image_count %}

            {% if media_count > 0 %}
              <div class="project-media-strip{% if media_count == 1 %} single{% else %} multi count-{{ media_count }}{% endif %}">

                {%- comment -%} Render videos first {%- endcomment -%}
                {% for item in video_items %}
                  {% assign item_type = "video" %}
                  {% assign item_url = item.url %}
                  {% assign thumb_url = item.thumbnail %}
                  {% if thumb_url == nil or thumb_url == "" %}
                    {% if item_url contains "youtube.com" or item_url contains "youtu.be" %}
                      {% assign yt_id = item_url %}
                      {% if yt_id contains "v=" %}
                        {% assign yt_id = yt_id | split:"v=" | last | split:"&" | first %}
                      {% elsif yt_id contains "youtu.be/" %}
                        {% assign yt_id = yt_id | split:"youtu.be/" | last | split:"?" | first %}
                      {% endif %}
                      {% assign thumb_url = "https://img.youtube.com/vi/" | append: yt_id | append: "/hqdefault.jpg" %}
                    {% endif %}
                  {% endif %}

                  <div class="project-thumb">
                    <a
                      href="{{ item_url }}"
                      target="_blank"
                      rel="noopener noreferrer"
                      class="project-thumb-link"
                      data-media-url="{{ item_url }}"
                      data-media-type="video"
                    >
                      {% if thumb_url %}
                        <img src="{{ thumb_url }}" alt="Media for {{ project.title }}" class="project-thumb-image" loading="lazy" />
                      {% else %}
                        <div class="project-thumb-placeholder">Open media</div>
                      {% endif %}
                      <div class="project-thumb-play">▶</div>
                    </a>
                  </div>
                {% endfor %}

                {%- comment -%} Then render images found in the project's source directory. {%- endcomment -%}
                    {% for f in site.static_files %}
                      {% assign rel = f.relative_path | default: '' %}
                      {% assign ext = f.extname | downcase %}
                      {% if ext == '.jpg' or ext == '.jpeg' or ext == '.png' or ext == '.gif' %}
                            {% assign matched = false %}
                            {% if rel != '' %}
                              {% if rel contains pub_dir %}
                                {% assign matched = true %}
                              {% endif %}
                            {% endif %}
                            {% if matched == false %}
                              {% if f.path contains src_dir %}
                                {% assign matched = true %}
                              {% endif %}
                            {% endif %}
                            {% if matched == true %}
                              {% assign img_url = rel %}
                              {% if img_url == '' %}
                                {% assign img_url = f.path | remove: site.source %}
                              {% endif %}
                              <div class="project-thumb">
                                <a href="{{ img_url }}" target="_blank" rel="noopener noreferrer" class="project-thumb-link" data-media-url="{{ img_url }}" data-media-type="image">
                                  <img src="{{ img_url }}" alt="Media for {{ project.title }}" class="project-thumb-image" loading="lazy" />
                                </a>
                              </div>
                            {% endif %}
                      {% endif %}
                    {% endfor %}

              </div>
            {% endif %}

            <div class="project-body">
              <h3 class="project-title">{{ project.title }}</h3>
              <div class="project-meta">
                {{ project.semester }}{% if project.students %} · {{ project.students }}{% endif %}
              </div>
              <div class="project-desc">
                {{ project.content | markdownify }}
              </div>
            </div>
          </article>
          {% endunless %}

        {% endfor %}
      </div>
    </section>

  </main>
</body>
</html>

